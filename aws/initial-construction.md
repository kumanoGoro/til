# AWS初期構築

https://engineers.weddingpark.co.jp/?p=523

## AWS上にJavaのWebアプリを構築する。
1. ネットワーク構築
VPCとAZの設定をする。
1. サーバ構築
1. Webサーバーソフトインストール
1. DBインストール
1. Javaインストール
1. 知っておくと良い周辺知識たち

### 1.ネットワーク構築
#### 1.VPC作成
1. [ホーム画面] > [VPC] を選択
1. 右上からVPCの操作対象とするリージョンを設定.(どこでも良い.)
1. [Your VPCs] > [Create VPC] でVPC領域を作成.
[Name Tag]： VPCにつける名前(なんでも良い.)
[CIDR block]： IPアドレス範囲(ここでは10.0.0.0/16のプライベートIPアドレスとする)

#### 2.サブネット作成

#### 3.インターネットと接続する
1. インターネットゲートウェイを作成する
[Internet Gateways] > [Create Internet Gateway]
1. VPC領域に結びつける.
作成したインターネットゲートウェイにチェックをつけてから、[Attach to VPC]をクリック。結びつけるVPC領域を選択。

#### 4.ルーティング設定
1. サブネットに割り当てられたルートテーブルのRoute Table IDを確認する。
ルートテーブルには、Route Table IDという識別子が付けられている。まず[Subnets]をクリックして、Route Table IDを確認する。
1. ルートテーブルの設定値を確認する
[Route Tables] > 1で確認したRoute Table IDを持つルートテーブルをクリック。[Routes]タブをクリックすると、現在の設定値を確認できる。デフォルトでは、
```
デスティネーション：ターゲット
10.0.0.0/16：local
```
という1項目だけが設定されている。VPC領域のCIDRブロックである「10.0.0.0/16」に含まれるIPアドレス宛のパケットであれば、VPC領域のルーターに接続されている相手への通信なので、VPC領域のルーター(つまり自分のローカル)にパケットを転送するという意味。現在の設定だと、「10.0.0.0/16の範囲外の宛先のパケット」は全て破棄される。

##### インターネットに向けて設定

「0.0.0.0/0の範囲の宛先のパケットはインターネットゲートウェイに転送する」という設定をルートテーブルに追加する。「0.0.0.0/0」は全てのIPアドレス範囲を示しているので、「転送先が指定されていない時のデフォルトの転送先」を示す。(デフォルトゲートウェイ)
1. 新しいルートテーブルを作成
デフォルトのルートテーブルは、全てのサブネットに適用されているため変更したくないので、新しくルートテーブル作成して、サブネットに割り当てる作戦。
[Route Tables] > [Create Route Table]
1. ルートテーブルをサブネットに割り当てる
1で作成したルートテーブルを、パブリックサブネットに割り当てる。[Subnet Associations] > [Edit]で割り当てるサブネットを選択。
1. デフォルトゲートウェイをインターネットゲートウェイに設定
Destinationに0.0.0.0/0、Targetにはインターネットゲートウェイを設定した項目を加える。(インターネットゲートウェイはigw-XXX..のやつ。)

### 2.サーバ構築
#### 1.EC2インスタンス作成
1. リージョンの確認(VPCと同じところに設定)
1. [Instances] > [Launch Instance]
1. AMIを選択(Amaxon Machine Image).OSがインストールされて初期のアカウントの設定まで済んだもの。今回はAmazon Linux AMIを選択。
1. インスタンスタイプを選択。(仮想マシンのスペック)
1. インスタンスの詳細情報を設定。
 1. VPCとサブネット インスタンスを配置するサブネットを選択。[Network]で配置したいVPC領域を選択し、[Subnet]で配置したいサブネット(先ほどパブリックに設定したもの)を選択する。
 1. パブリックIPアドレス インターネットからこのインスタンスにアクセスできるようにするため、パブリックIPアドレスを付与。[Automatically assign a public IP address to your instances]にチェック。
 1. プライベートIPアドレス このインスタンスには、プライベートIPアドレスも設定しましょう。「プライベートサブネット」に、先ほど「10.0.1.0/24」を定義しているので、「10.0.1.0~10.0.1.255」のいずれかのIPアドレスを指定できる。 ここでは、「10.0.1.10」を割り当てる。
1. ストレージを設定する。デフォでおk。
1. インスタンスに名前をつける。なんでもいい。
1. セキュリティグループ設定する。
セキュリティグループはインスタンスに対して、セキュリティを設定する機能。後々説明する。
1. インスタンスを起動。[Launch]をクリック。
1. キーペアを作成してダウンロード。インスタンスにログインする際に必要になる「鍵」。
1. インスタンスの起動。キーペアをダウンロードしたら、[Launch Instances]ボタンをクリックして、インスタンスを起動。[View Instances]をクリックすると、インスタンス一覧画面を表示できる。